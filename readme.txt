ニコニコDLのためのツール
動画DL部分はyt-dlpに完全に委託している

2024/09/23
・公式動画のシリーズページから動画URLを取れるようにしました
  (nicovideo.jp/seriesという形式
   普通のユーザーのシリーズもこの形式でリダイレクトするのですが
   ページから情報を得ないと見分けがつかないのがめんどいので
   現状はこの形式は公式動画のものとして扱うことにします)

・ログイン処理に失敗したらuser_sessionでログイン可能だったものができなくなる問題の修正
・'nicovideo.jp/mylist' のような形式のURLを正しく読めるように修正

アプデ予定
・やっぱりGUI作るかも ただ動画の管理とかは考えていません
・フォルダを読んでファイル名の動画idからコメントを取得する機能に
  動画のファイル名にコメントファイル名を合わせるオプションをつける
・2段階認証の対策


2024/09/21
・オプションのbool値関係の改善

2024/09/20
・起動時のバージョン表示(日付)
・is_kantanのオプション追加 かんたんコメントを取るかどうか デフォルトはfalse(無効)
  ちなみにそれまでのバージョンではかんたんコメントは単に無視していました
・起動時のcomment_mailとcomment_passに目隠し効果
・ログイン処理をコマンドで手動でするようにしました
・ログイン状態にあるかどうかを確認できるようにしました
・nicodl_user_session.txtを廃止 nicodl_option.jsonに移りました
・その他細かい修正

2024/09/12
コメント過去ログ取得に対応

どうやら2段階認証設定しているとログインできないみたいです
現状ではブラウザからF12でuser_sessionをコピーして
nicodl_option.jsonにコピーするのが良いと思います

…
専用ブラウザを起動してログインして貰う方法が楽だと思ったので調べてみるつもり

あと動画URLの範囲等の指定をできるようにしたいと思っています
たぶんテキストエディタにコピーして整形した後に
それをまたコピーして貼り付ける方法になると思います


・設定
yt-dlp.exeはPATH設定するかexeと同じ場所に置くか設定にパスを書いて下さい

オプションファイルはexeと同じ場所のnicodl_option.jsonです
文字コードはutf-8です

# オプションファイルの例
{
"dl_dir": "C:/nicovideo",            # 動画のダウンロードフォルダ
"yt_dlp_path": "C:/tool/yt_dlp.exe", # yt-dlpの.exeへのパス yt-dlpのオプションもここに書いて下さい
"comment_mail": "",                  # アカウントのメールアドレス
"comment_pass": "",                  # アカウントのパスワード
"user_session": "",                  # ブラウザから取得できるuser_session, mail passとはどちらかさえあればいい
"is_video": "",                      # 動画をDLするかどうか bool
"is_comment": "",                    # コメントをDLするかどうか (この設定はフォルダのファイルのIDを読み込むやつには適応されない) bool
"is_kakolog": "true",                # 過去ログをDLするかどうか bool
"is_kantan": "false",                # かんたんコメントをDLするかどうか bool
"comment_fileformat": "*title* [*id*][*comment_num*コメ].xml", # コメントファイル名の書式
"end_presswait": "true"              # 完了後にキー待ちをする bool
}


・ログイン方法は今のところ2つあり
comment_mail comment_passを埋めて毎回コマンドでログインする方法
ブラウザからuser_sessionを抜き出して使用する方法があります

ブラウザのuser_sessionはいつ切れるかわかりませんが更新しなくてもかなり長い間使えるっぽいです
(おそらくログアウトするまで？)

mail passだと毎回ログインする必要があるらしいです

user_sessionはnicovideo.jpページを開きログインした後F12を押してストレージやcookie等の欄にあると思いますが
詳しくは [<ブラウザ名> F12 cookie] などで検索して下さい


・ファイルパスの¥(バックスラッシュまたは円記号)は/(スラッシュ)かバックスラッシュ2つに変換してください
jsonはバックスラッシュ1つだけだとエラーになります

・bool値はtrueかfalseでyes noの意味になります すべて小文字です
(型は文字列型でもboolean型でもOKです)

・何も書かなければデフォルトの良さげな設定になります

・comment_mailとcomment_passはコメント取得にのみ適応されます
もしプレミアムの動画をDLしたい場合はyt_dlp_pathに設定を書いて下さい
オプションについては↓URLの[USAGE AND OPTIONS]参照
例えばログインしたければ "yt_dlp_path": "yt-dlp -u メールアドレス -p パスワード"

・現在自分が使っているyt-dlp
https://github.com/yt-dlp/yt-dlp

・過去ログDLは大量のコメントがある場合かなり遅くなります
過去ログを取らない設定の場合は一回のPOSTで済むため非常に高速です

・コメント数と実際に取得されてるコメントの数が合わない場合
大抵は削除されたコメントがあるか(これが結構かなりの数ある)
かんたんコメントを取得するかどうかが関係している可能性が高いです


ファイルを削除するようなコードは書かないようにしているのでそこは大丈夫だと思います
フォルダ内を[0コメ]と検索すればコメントを取れなかった動画がわかると思います
コメント取得のアルゴリズムとかはあやふやですが多分大丈夫かなって感じです
GUIを作る気はないです

everythingというソフトおすすめです
PCの全領域からファイルを検索できます
動画ファイルの存在確認に便利です
Commeonにファイルをドラッグドロップしたり
