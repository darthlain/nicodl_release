ニコニコDLのためのツール
動画DL部分はyt-dlpに完全に委託している

2024/09/12
コメント過去ログ取得に対応

どうやら2段階認証設定しているとログインできないみたいです
現状ではブラウザからF12でuser_sessionをコピーして
nicodl_user_session.txtにコピーするのが良いと思います
改行や空白を作ってはいけないので注意

ひょっとしたら直さないかも めんどいので…
というよりuser_sessionをブラウザから取る方法を正規にするかもしれない
それが一番実装的にはシンプルで済むので

…
専用ブラウザを起動してログインして貰う方法が楽だと思ったので調べてみるつもり

あと動画URLの範囲等の指定をできるようにしたいと思っています
たぶんテキストエディタにコピーして整形した後に
それをまたコピーして貼り付ける方法になると思います



・現状の問題点
公式動画のシリーズページから取れない これは修正予定

・設定
yt-dlp.exeはPATH設定するかexeと同じ場所に置くか設定にパスを書いて下さい

オプションファイルはexeと同じ場所のnicodl_option.jsonです
文字コードはutf-8です

# オプションファイルの例
{
"dl_dir": "C:/nicovideo",            # 動画のダウンロードフォルダ
"yt_dlp_path": "C:/tool/yt_dlp.exe", # yt-dlpの.exeへのパス yt-dlpのオプションもここに書いて下さい
"comment_mail": ""                   # アカウントのメールアドレス
"comment_pass": ""                   # アカウントのパスワード
"end_presswait": "true"              # 完了後にキー待ちをする bool値
"is_video": ""                       # 動画をDLするかどうか
"is_comment": ""                     # コメントをDLするかどうか (この設定はフォルダのファイルのIDを読み込むやつには適応されない)
"is_kakolog": "true"                 # 過去ログをDLするかどうか
"comment_fileformat": "*title* [*id*][*comment_num*コメ].xml" # コメントファイル名の書式
}

ファイルパスの¥(バックスラッシュまたは円記号)は/(スラッシュ)かバックスラッシュ2つに変換してください
jsonはバックスラッシュ1つだけだとエラーになります

bool値はtrueかfalseでyes noの意味になります すべて小文字です

何も書かなければデフォルトの良さげな設定になります

comment_mailとcomment_passはコメント取得にのみ適応されます
もしプレミアムの動画をDLしたい場合はyt_dlp_pathに設定を書いて下さい
オプションについては↓URLの[USAGE AND OPTIONS]参照
例えばログインしたければ "yt_dlp_path": "yt-dlp -u メールアドレス -p パスワード"

・自分が使っているyt-dlp
https://github.com/yt-dlp/yt-dlp

過去ログDLは大量のコメントがある場合かなり遅くなります
過去ログを取らない設定の場合は一回のPOSTで済むため非常に高速です

ログインする場合exeと同じ場所にnicodl_user_session.txtというファイルが生成されます
ここにuser_sessionを書いても一応ログイン処理できるはずです


ファイルを削除するようなコードは書かないようにしているのでそこは大丈夫だと思います
フォルダ内を[0コメ]と検索すればコメントを取れなかった動画がわかると思います
コメント取得のアルゴリズムとかはあやふやですが多分大丈夫かなって感じです
GUIを作る気はないです
かんたんコメントはとりあえず含まないことにしてます

関係ないですがeverythingというソフトが動画ファイルの存在確認に便利です
